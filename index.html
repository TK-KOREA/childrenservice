<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•ˆì–‘êµíšŒ ìœ ì´ˆë“±ë¶€ - ì¼ì • ë° ë´‰ì‚¬ ì•ˆë‚´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #fdfcf8; scroll-behavior: smooth; }
        
        /* ë‹¬ë ¥ ì¹¸ ê°„ê²© ìµœì†Œí™” */
        .calendar-day { 
            min-height: 90px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: flex-start; 
            padding: 0.2rem 0.1rem; 
            border-radius: 0.4rem; 
            position: relative; 
            transition: all 0.2s; 
            border: 1px solid #f1f5f9; 
            background: white; 
            overflow: hidden; 
        }
        @media (min-width: 768px) { 
            .calendar-day { 
                min-height: 135px; 
                padding: 0.4rem 0.2rem; 
                border-radius: 0.6rem; 
            } 
        }
        .calendar-day:hover { background-color: #fffaf5; z-index: 10; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); }
        
        /* ì´ë²¤íŠ¸ ë°” í…ìŠ¤íŠ¸ ìµœì í™” */
        .event-bar { 
            font-size: 10px; 
            padding: 2px 4px; 
            border-radius: 3px; 
            margin-top: 1px; 
            width: 98%; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            white-space: nowrap; 
            font-weight: 700; 
            cursor: pointer; 
            text-align: left; 
            border-width: 1.5px;
            line-height: 1.2;
        }
        @media (max-width: 768px) { 
            .event-bar { 
                font-size: 8px; 
                padding: 1px 2px; 
                letter-spacing: -0.05em;
            } 
        }
        
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #fb923c; border-radius: 50%; width: 28px; height: 28px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .section-card { background: white; border-radius: 1.5rem; box-shadow: 0 10px 30px -10px rgba(0,0,0,0.04); border: 1px solid #f1f5f9; overflow: hidden; }
        .kids-gradient { background: linear-gradient(135deg, #fb923c 0%, #facc15 100%); }
    </style>
</head>
<body class="text-slate-800">

    <!-- ë¡œë”© í™”ë©´ -->
    <div id="loadingOverlay" class="fixed inset-0 bg-white/95 backdrop-blur-md z-50 flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="loader mb-4"></div>
        <p class="text-orange-600 font-bold tracking-tight">ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
    </div>

    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="sticky top-0 z-40 bg-white/80 backdrop-blur-md border-b border-orange-100">
        <div class="max-w-6xl mx-auto px-4 h-14 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="w-7 h-7 kids-gradient rounded-lg flex items-center justify-center text-white font-black shadow-sm text-sm">ê¿ˆ</div>
                <span class="font-black text-lg tracking-tight text-slate-800">ì•ˆì–‘êµíšŒ ìœ ì´ˆë“±ë¶€</span>
            </div>
            <div class="text-[10px] font-bold text-slate-400 bg-slate-50 px-2.5 py-1 rounded-full border border-slate-100 uppercase tracking-widest">
                Ministry Calendar
            </div>
        </div>
    </nav>

    <!-- íˆì–´ë¡œ ì„¹ì…˜ -->
    <header class="max-w-6xl mx-auto px-6 pt-6 pb-2 text-center">
        <h1 class="text-2xl md:text-4xl font-black text-slate-900 mb-1">
            ìš°ë¦¬ë“¤ì˜ <span class="text-orange-500">ì¦ê±°ìš´ ì•½ì†</span>
        </h1>
        <p class="text-slate-500 text-xs md:text-sm">ëª¨ì„ ìœ í˜•ë³„ ìƒì„¸ ì¼ì •ì„ í™•ì¸í•˜ì„¸ìš”.</p>
    </header>

    <main class="max-w-7xl mx-auto px-1 md:px-4 pb-16">
        <section id="schedule" class="mt-2">
            <div class="section-card p-1 md:p-4">
                <!-- ë‹¬ë ¥ ì»¨íŠ¸ë¡¤ëŸ¬ -->
                <div class="flex justify-between items-center mb-4 px-1">
                    <button id="prevMonth" class="p-2 text-slate-400 hover:text-orange-500 rounded-full hover:bg-orange-50 active:scale-90 transition-all">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    
                    <div class="flex flex-col items-center">
                        <div class="flex items-center gap-2">
                            <h3 id="calendarTitle" class="text-xl md:text-3xl font-black text-slate-800 tracking-tight">ë¡œë”©ì¤‘...</h3>
                            <button onclick="goToToday()" class="text-[10px] font-black text-orange-600 bg-orange-50 border border-orange-200 px-2 py-1 rounded-full">Today</button>
                        </div>
                    </div>

                    <button id="nextMonth" class="p-2 text-slate-400 hover:text-orange-500 rounded-full hover:bg-orange-50 active:scale-90 transition-all">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                </div>

                <!-- ìš”ì¼ í—¤ë” -->
                <div class="grid grid-cols-7 gap-1 md:gap-1.5 text-center mb-1 border-b border-slate-50 pb-1">
                    <div class="text-red-400 font-black text-[10px] md:text-xs">Sun</div>
                    <div class="text-slate-300 font-black text-[10px] md:text-xs">Mon</div>
                    <div class="text-slate-300 font-black text-[10px] md:text-xs">Tue</div>
                    <div class="text-slate-300 font-black text-[10px] md:text-xs">Wed</div>
                    <div class="text-slate-300 font-black text-[10px] md:text-xs">Thu</div>
                    <div class="text-slate-300 font-black text-[10px] md:text-xs">Fri</div>
                    <div class="text-blue-400 font-black text-[10px] md:text-xs">Sat</div>
                </div>

                <!-- ë‹¬ë ¥ ê·¸ë¦¬ë“œ -->
                <div id="calendarGrid" class="grid grid-cols-7 gap-1 md:gap-1 text-center"></div>
            </div>
        </section>
    </main>

    <!-- ìƒì„¸ ì¼ì • ëª¨ë‹¬ -->
    <div id="detailModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="fixed inset-0 bg-slate-900/60 backdrop-blur-md transition-opacity" onclick="closeModal()"></div>
        <div class="flex min-h-full items-center justify-center p-4">
            <div class="bg-white rounded-[2rem] shadow-2xl w-full max-w-lg relative overflow-hidden transform transition-all animate-in zoom-in duration-200">
                <button onclick="closeModal()" class="absolute top-6 right-6 text-slate-300 hover:text-slate-800 bg-slate-100 rounded-full p-2 transition-colors z-10">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
                <div id="modalContent" class="p-8 md:p-10">
                    <!-- ìƒì„¸ ë‚´ìš© ì‚½ì… -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const SHEET_ID = '18zGuXQQWPm_dM2W6xD2Ugysaiz-sukIFJByO_TZrFy0'; 
        let events = []; 
        const todayObj = new Date();
        let currentDate = new Date(todayObj.getFullYear(), todayObj.getMonth(), 1); 

        async function fetchGoogleSheetData() {
            try {
                const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&t=${Date.now()}`;
                const res = await fetch(url);
                const text = await res.text();
                const json = JSON.parse(text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1));
                const rows = json.table.rows;
                
                events = rows.map((r, idx) => {
                    const startRaw = r.c[0]?.v;
                    if (!startRaw || r.c[0]?.f === "ì‹œì‘ì¼") return null; 

                    return {
                        id: idx,
                        start: parseGoogleDate(startRaw, r.c[0]?.f),
                        end: parseGoogleDate(r.c[1]?.v, r.c[1]?.f),
                        startTime: formatGoogleTime(r.c[2]?.v),
                        endTime: formatGoogleTime(r.c[3]?.v),
                        meetingType: r.c[4]?.v || "ì†Œê·¸ë£¹",
                        leader: r.c[5]?.v || "-",
                        speaker: r.c[6]?.v || "-",
                        division: r.c[7]?.v || "-",
                        mealPrep: r.c[8]?.v || "-",
                        mealTeam: r.c[9]?.v || "-",
                        menu: r.c[10]?.v || "-",
                        wash: r.c[11]?.v || "-",
                        subject: r.c[12]?.v || "",
                        note: r.c[13]?.v || ""
                    };
                }).filter(e => e !== null);
            } catch (e) { 
                console.error("Data Fetch Error:", e); 
            }
            
            document.getElementById('loadingOverlay').classList.add('hidden');
            renderCalendar();
        }

        function parseGoogleDate(raw, formatted) {
            if (!raw) return null;
            if (typeof raw === 'string' && raw.startsWith('Date')) {
                const m = raw.match(/Date\((\d+),(\d+),(\d+)\)/);
                if (m) return new Date(m[1], m[2], m[3]);
            }
            return new Date(formatted || raw);
        }

        function formatGoogleTime(raw) {
            if (!raw || typeof raw !== 'string') return raw || "";
            if (raw.startsWith('Date(1899,11,30')) {
                const m = raw.match(/Date\(1899,11,30,(\d+),(\d+),(\d+)\)/);
                if (m) {
                    const h = m[1].padStart(2, '0');
                    const min = m[2].padStart(2, '0');
                    return `${h}:${min}`;
                }
            }
            return raw;
        }

        function getEventColor(type) {
            switch(type) {
                case 'ì£¼ì¼ì§‘íšŒ': return 'bg-blue-50 text-blue-700 border-blue-200';
                case 'ì†Œê·¸ë£¹': return 'bg-orange-50 text-orange-700 border-orange-200';
                case 'ì•„ì›ƒíŒ…': return 'bg-green-50 text-green-700 border-green-200';
                case 'íŠ¹ë³„ì§‘íšŒ': return 'bg-purple-50 text-purple-700 border-purple-200';
                case 'ì„ì„': return 'bg-pink-50 text-pink-700 border-pink-200';
                default: return 'bg-slate-50 text-slate-500 border-slate-200';
            }
        }

        function renderCalendar() {
            const y = currentDate.getFullYear(), m = currentDate.getMonth();
            document.getElementById('calendarTitle').innerHTML = `${y}ë…„ <span class="text-orange-500">${m+1}ì›”</span>`;
            
            const first = new Date(y, m, 1).getDay();
            const last = new Date(y, m+1, 0).getDate();
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            for(let i=0; i<first; i++) grid.innerHTML += '<div></div>';
            
            for(let i=1; i<=last; i++) {
                const targetDate = new Date(y, m, i);
                const isToday = (y === todayObj.getFullYear() && m === todayObj.getMonth() && i === todayObj.getDate());
                
                const dayEvents = events.filter(e => {
                    if(!e.start) return false;
                    const start = new Date(e.start); start.setHours(0,0,0,0);
                    const end = e.end ? new Date(e.end) : new Date(e.start); 
                    end.setHours(23,59,59,999);
                    return targetDate >= start && targetDate <= end;
                });

                let textClass = "text-slate-800";
                const dayOfWeek = targetDate.getDay();
                if (dayOfWeek === 0) textClass = "text-red-400";
                else if (dayOfWeek === 6) textClass = "text-blue-400";

                const eventHtml = dayEvents.map(e => {
                    const displayTitle = e.meetingType;
                    return `
                        <div class="event-bar border ${getEventColor(e.meetingType)}" onclick="event.stopPropagation(); openModal(${e.id})">
                            ${e.startTime ? `<span class="opacity-60 mr-0.5">${e.startTime}</span>` : ''}${displayTitle}
                        </div>
                    `;
                }).join('');

                grid.innerHTML += `
                    <div class="calendar-day" onclick="openDayInfo(${y}, ${m}, ${i})">
                        <div class="flex items-center justify-center w-6 h-6 md:w-8 md:h-8 ${isToday?'bg-orange-500 text-white rounded-full shadow-md':textClass} font-black text-[10px] md:text-sm mb-0.5">
                            ${i}
                        </div>
                        <div class="w-full flex flex-col items-center overflow-hidden px-px">
                            ${eventHtml}
                        </div>
                    </div>`;
            }
        }

        window.openModal = (eventId) => {
            const e = events.find(item => item.id === eventId);
            if (!e) return;

            const sDate = new Date(e.start).toLocaleDateString('ko-KR', { month: 'long', day: 'numeric', weekday: 'short' });
            const eDate = e.end ? new Date(e.end).toLocaleDateString('ko-KR', { month: 'long', day: 'numeric', weekday: 'short' }) : sDate;
            const dateDisplay = (sDate === eDate) ? sDate : `${sDate} ~ ${eDate}`;
            const timeDisplay = (e.startTime || e.endTime) ? `${e.startTime || ''} ~ ${e.endTime || ''}` : "ì¢…ì¼ ì¼ì •";

            let detailHtml = '';

            if (e.meetingType === 'ì£¼ì¼ì§‘íšŒ') {
                detailHtml = `
                    <div class="bg-white border border-slate-100 rounded-2xl overflow-hidden shadow-sm">
                        <div class="bg-blue-50/50 px-4 py-2 border-b border-blue-100 text-[10px] font-black text-blue-400 uppercase tracking-widest text-center">ì£¼ì¼ ì§‘íšŒ ì •ë³´</div>
                        <div class="p-6 space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-xs font-bold text-slate-400 uppercase tracking-tighter">ì§„í–‰ ë‹´ë‹¹</span>
                                <span class="text-sm font-black text-slate-700">${e.leader}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs font-bold text-slate-400 uppercase tracking-tighter">ë§ì”€ ë‹´ë‹¹</span>
                                <span class="text-sm font-black text-slate-700">${e.speaker}</span>
                            </div>
                            <div class="flex justify-between items-center pt-3 border-t border-slate-50">
                                <span class="text-xs font-bold text-slate-400 uppercase tracking-tighter">ë¶„ë°˜ ë‹´ë‹¹</span>
                                <span class="text-sm font-black text-blue-600">${e.division}</span>
                            </div>
                        </div>
                    </div>
                `;
            } else if (e.meetingType === 'ì†Œê·¸ë£¹') {
                detailHtml = `
                    <div class="bg-white border border-slate-100 rounded-2xl overflow-hidden shadow-sm">
                        <div class="bg-orange-50/50 px-4 py-2 border-b border-orange-100 text-[10px] font-black text-orange-400 uppercase tracking-widest text-center">ì†Œê·¸ë£¹ ë° ì‹ì‚¬ ì•ˆë‚´</div>
                        <div class="p-6 space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-xs font-bold text-slate-400 uppercase tracking-tighter">ì§„í–‰/ë´‰ì‚¬ë‹´ë‹¹</span>
                                <span class="text-sm font-black text-slate-700">${e.leader}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs font-bold text-slate-400 uppercase tracking-tighter">ì‹ì‚¬ì¤€ë¹„ / íŒ€</span>
                                <span class="text-sm font-black text-slate-700">${e.mealPrep} <span class="text-slate-300 font-normal">|</span> ${e.mealTeam}</span>
                            </div>
                            <div class="pt-4 border-t border-slate-50">
                                <div class="text-[10px] font-bold text-orange-400 mb-1 flex items-center justify-center gap-1">ğŸ½ï¸ ì˜¤ëŠ˜ì˜ ë©”ë‰´</div>
                                <div class="text-lg md:text-xl font-black text-slate-800 text-center leading-tight">${e.menu}</div>
                            </div>
                            <div class="flex justify-between items-center pt-3 border-t border-slate-50">
                                <span class="text-xs font-bold text-slate-400 uppercase tracking-tighter">ì„¤ê±°ì§€ ë´‰ì‚¬</span>
                                <span class="text-sm font-bold text-slate-600">${e.wash}</span>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // DEFAULT íŒì—… í™”ë©´ êµ¬ì„± (ì£¼ì¼ì§‘íšŒ, ì†Œê·¸ë£¹ì´ ì•„ë‹Œ ê²½ìš°)
                detailHtml = `
                    <div class="bg-slate-50 p-6 rounded-2xl border border-slate-100 shadow-sm">
                        <div class="text-[10px] font-bold text-slate-400 mb-3 uppercase tracking-widest text-center border-b border-slate-200 pb-2">ìƒì„¸ ë‚´ì—­</div>
                        <div class="text-sm text-slate-700 leading-relaxed font-medium whitespace-pre-wrap">
                            ${e.note || "ë“±ë¡ëœ ìƒì„¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤."}
                        </div>
                    </div>
                `;
            }

            document.getElementById('modalContent').innerHTML = `
                <div class="text-center mb-6">
                    <!-- ë©”ì¸ íƒ€ì´í‹€: ëª¨ì„ ìœ í˜• -->
                    <div class="inline-block px-6 py-2.5 ${getEventColor(e.meetingType)} rounded-full text-lg md:text-2xl font-black uppercase tracking-widest border-2 shadow-sm mb-2 leading-tight">
                        ${e.meetingType}
                    </div>
                    <!-- ë¶€ì œ: ì£¼ì œ -->
                    ${e.subject ? `
                        <div class="text-slate-500 font-bold text-sm md:text-base mt-1 italic tracking-tight opacity-80">
                            ${e.subject}
                        </div>
                    ` : ''}
                </div>
                
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-100 shadow-sm">
                            <div class="text-[10px] font-bold text-slate-400 mb-1 uppercase tracking-tighter">ì¼ì‹œ</div>
                            <div class="text-xs font-bold text-slate-700">${dateDisplay}</div>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-100 shadow-sm">
                            <div class="text-[10px] font-bold text-slate-400 mb-1 uppercase tracking-tighter">ì‹œê°„</div>
                            <div class="text-xs font-bold text-orange-500">${timeDisplay}</div>
                        </div>
                    </div>

                    ${detailHtml}

                    <!-- ë¹„ê³  ì‚¬í•­ í‘œì‹œ (ì£¼ì¼ì§‘íšŒ/ì†Œê·¸ë£¹ì¸ ê²½ìš°ì—ë§Œ ì¶”ê°€ í•˜ë‹¨ ì„¹ì…˜ìœ¼ë¡œ í‘œì‹œ) -->
                    ${e.note && (e.meetingType === 'ì£¼ì¼ì§‘íšŒ' || e.meetingType === 'ì†Œê·¸ë£¹') ? `
                    <div class="bg-orange-50/30 p-4 rounded-xl border border-orange-100 border-dashed">
                        <div class="text-[10px] font-bold text-orange-400 mb-1 uppercase tracking-tighter">ë¹„ê³  ì‚¬í•­</div>
                        <div class="text-slate-600 text-xs leading-relaxed whitespace-pre-wrap">${e.note}</div>
                    </div>` : ''}
                </div>
            `;
            document.getElementById('detailModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        };

        window.openDayInfo = (y, m, d) => {
            const target = new Date(y, m, d);
            const dayEvents = events.filter(e => {
                const start = new Date(e.start); start.setHours(0,0,0,0);
                const end = e.end ? new Date(e.end) : new Date(e.start); 
                end.setHours(23,59,59,999);
                return target >= start && target <= end;
            });
            if (dayEvents.length > 0) openModal(dayEvents[0].id);
        };

        window.closeModal = () => {
            document.getElementById('detailModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        };

        document.getElementById('prevMonth').onclick = () => { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(); };
        document.getElementById('nextMonth').onclick = () => { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(); };
        window.goToToday = () => { currentDate = new Date(todayObj.getFullYear(), todayObj.getMonth(), 1); renderCalendar(); };

        fetchGoogleSheetData();
    </script>
</body>
</html>
